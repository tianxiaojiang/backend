<script type="text/html" template lay-url="/index/common/news-status" lay-done="editNewsCallback(d);">
    <form class="layui-form" action="">
        <div class="layui-form-item">
            <label class="layui-form-label">标题</label>
            <div class="layui-input-block"><input type="text" name="title" required lay-verify="required" placeholder="标题" autocomplete="off" class="layui-input"  value="{{ d.params.title }}"/></div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">简介</label>
            <div class="layui-input-block"> <input type="text" name="description" required lay-verify="required" placeholder="简介" autocomplete="off" class="layui-input"  value="{{ d.params.descriptioin }}"/></div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">内容</label>
            <div class="layui-input-block">
                <textarea name="content" placeholder="内容" autocomplete="off" class="layui-textarea">{{ d.params.content }}</textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">状态</label>
            <div class="layui-input-block">
                <select name="status" required lay-verify="required" id="news-select-status">
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <input type="hidden" name="id"  value="{{ d.params.news_id }}"/>
                <input type="hidden" name="old_news_status"  value="{{ d.params.news_id }}"/>
                <button class="layui-btn" lay-submit="" lay-filter="update-news">提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</script>
<script>
    var editNewsCallback = function (d) {
        layui.use(['table', 'laytpl', 'form', 'ztutil', 'admin', 'view'], function () {

            var $ = layui.jquery, table = layui.table, form = layui.form, laytpl = layui.laytpl, ztutil = layui.ztutil, admin = layui.admin, view = layui.view;

            // 获取状态列表
            var getStatus = function () {
                var statusHTML = '';
                var options = {
                    url: '/index/common/news-status',
                    done: function (res) {
                        var old_status = $('#old_news_status').text();
                        $.each(res.data, function (i, v) {
                            // 当前状态是否为选中状态
                            if (v == old_status) {
                                statusHTML += '<option value="' + i + '" selected>' + v + '</option>';
                            } else {
                                statusHTML += '<option value="' + i + '">' + v + '</option>';
                            }
                        });
                        $('#news-select-status').html(statusHTML);
                        form.render();
                    }
                };
                admin.req(options);
            };
            getStatus();

            // 编辑管理员按钮
            form.on('submit(update-news)', function (data) {
                var options = {
                    data: data.field,
                    url: '/index/news1/update?id=' + data.field.id,
                    method: 'patch',
                    done: function () {
                        layer.closeAll();
                        table.reload('system-newses');
                        layer.msg('修改文章成功！');
                    }
                };
                admin.req(options);
                return false;
            });

        });
    };
</script>