<title>游戏列表</title>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-card">
            <div class="layui-card-body">
                <div class="layui-btn-container">
                    <button class="layui-btn" id="btn-add-game">添加</button>
                </div>
                <table class="layui-table" id="system-game" lay-size="lg" lay-filter="game"></table>
                <script type="text/html" id="game-option">
                    <a class="layui-btn layui-btn-sm" lay-event="edit">修改</a>
                    <a class="layui-btn layui-btn-sm layui-btn-danger" data-type="t" lay-event="del">删除</a>
                </script>
            </div>
        </div>
    </div>
</div>

<script>
layui.use(['table', 'laytpl', 'form', 'ztutil', 'admin', 'view', 'element'], function() {

    var $ = layui.jquery, table = layui.table, form = layui.form, laytpl = layui.laytpl, ztutil = layui.ztutil, admin = layui.admin, view = layui.view, element = layui.element;

    // 点击添加用户按钮
    $('#btn-add-game').on('click', function () {
        var data = {};
        var index = layer.load(1);
        layer.open({
            type: 1,
            id: 'LAY-system-games-add',
            title: '添加游戏',
            resize: false,
            success: function () {
                view(this.id).render('/system/games/add', data).done(function () {
                    layer.close(index);
                    $(window).trigger('resize');
                });
            }
        });
    });

    // 渲染游戏列表
    table.render({
        elem: '#system-game',
        url:'/admin/game/index',
        where: ztutil.createSign(),
        size: 'lg',
        headers: {
            Authorization: ztutil.getToken()
        },
        cols: [[
            {type: 'checkbox'},
            {field:'game_id', title:'游戏ID', sort: true},
            {field:'name', title:'游戏名称', sort: true},
            {field:'alias', title:'英文别名', sort: true},
            {field:'status', title:'状态', sort: true},
            {field:'updated_at', title:'最后修改时间', sort: true},
            {field:'created_at', title:'添加时间', sort: true},
            {title:'操作', toolbar: '#game-option'}
        ]],
        page: true
    });

    // 删除游戏请求
    var deleteGame = function (id, obj) {
        var options = {
            url: '/admin/game/delete?id=' + id,
            method: 'delete',
            done: function () {
                obj.del();
                table.reload('system-game');
                layer.msg('删除成功！');
            }
        };
        admin.req(options);
    };

    // 监听工具条
    table.on('tool(game)', function(obj) {
        var data = obj.data;
        if (obj.event === 'del') {
            layer.confirm('是否要删除游戏：<strong>' + data.name + '</strong> ？', {
            }, function(index) {
                deleteGame(data.game_id, obj);
            });
        } else if (obj.event === 'edit') {
            var index = layer.load(1);
            layer.open({
                type: 1,
                id: 'LAY-system-game-update',
                title: '修改游戏' + data.name,
                resize: false,
                success: function () {
                    view(this.id).render('/system/games/update', data).done(function () {
                        layer.close(index);
                        $(window).trigger('resize');
                    });
                }
            });
        }
    });


});
</script>